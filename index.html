<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>mjpg-streamer-diy by ferstar</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">mjpg-streamer-diy</h1>
      <h2 class="project-tagline">mjpg-streamer patched for rspi2</h2>
      <a href="https://github.com/ferstar/mjpg-streamer-diy" class="btn">View on GitHub</a>
      <a href="https://github.com/ferstar/mjpg-streamer-diy/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/ferstar/mjpg-streamer-diy/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="mjpg-streamer-diy" class="anchor" href="#mjpg-streamer-diy" aria-hidden="true"><span class="octicon octicon-link"></span></a>mjpg-streamer-diy</h1>

<h2>
<a id="sources" class="anchor" href="#sources" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sources:</h2>

<ol>
<li>forked from <a href="https://svn.code.sf.net/p/mjpg-streamer/code">https://svn.code.sf.net/p/mjpg-streamer/code</a>
</li>
<li>patch from <a href="https://www.raspberrypi.org/forums/viewtopic.php?f=28&amp;t=109352">https://www.raspberrypi.org/forums/viewtopic.php?f=28&amp;t=109352</a>
</li>
<li>usage of <code>screen</code> command <a href="https://www.ibm.com/developerworks/cn/linux/l-cn-screen/">https://www.ibm.com/developerworks/cn/linux/l-cn-screen/</a>
</li>
</ol>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage:</h2>

<pre><code>cd mjpg-streamer
make USE_LIBV4L2=true clean all
sudo make DESTDIR=/usr/local install
</code></pre>

<h2>
<a id="my-way" class="anchor" href="#my-way" aria-hidden="true"><span class="octicon octicon-link"></span></a>My way:</h2>

<p>The YUV format ate too much memory and cpu time, so I chose MJPEG with <code>-e</code> parameter instead.</p>

<pre><code>screen -dmS videocap /usr/local/bin/mjpg_streamer \
    -i "/usr/local/lib/input_uvc.so -n -e 4 -f 60 -r 1024x576" \
    -o "/usr/local/lib/output_http.so -w /usr/local/www"
</code></pre>

<p>the output info looks like this:</p>

<pre><code> i: Using V4L2 device.: /dev/video0
 i: Desired Resolution: 1024 x 576
 i: Frames Per Second.: 60
 i: Format............: MJPEG
 i: Drop Frames Except: 4
 o: www-folder-path...: /usr/local/www/
 o: HTTP TCP port.....: 8080
 o: username:password.: disabled
 o: commands..........: enabled
</code></pre>

<p>at this capture setting, the bitrate of output mjpg stream is <code>2000kbps</code> or above(less than <code>3000kbps</code>)</p>

<p>works very well on my rspi2.</p>

<blockquote>
<p>load average: 0.00, 0.01, 0.05</p>

<p>CPU load: &lt; 2% (1.3±0.3)%</p>
</blockquote>

<h2>
<a id="addition" class="anchor" href="#addition" aria-hidden="true"><span class="octicon octicon-link"></span></a>Addition</h2>

<p>You could change the resolution with the parameters after <code>-r</code> but use <code>uvcdynctrl -f</code> to see which one is build-in</p>

<p>here are my C-270 logitech camera‘s build-in resolution and fps value:</p>

<p><code>uvcdynctrl -f</code> output:</p>

<pre><code>Listing available frame formats for device video0:
Pixel format: YUYV (YUV 4:2:2 (YUYV); MIME type: video/x-raw-yuv)
  Frame size: 640x480
    Frame rates: 30, 25, 20, 15, 10, 5
  ...
    ...
  Frame size: 1280x960
    Frame intervals: 2/15, 1/5
Pixel format: MJPG (MJPEG; MIME type: image/jpeg)
  Frame size: 640x480
    Frame rates: 30, 25, 20, 15, 10, 5
  ...
    ...
  Frame size: 1280x960
    Frame rates: 30, 25, 20, 15, 10, 5
</code></pre>

<p><code>lsusb</code> output:</p>

<pre><code>...
Bus 001 Device 006: ID 046d:0825 Logitech, Inc. Webcam C270
...
</code></pre>

<p>make mjpg-streamer auto start if USB camera is in:
<code>vi /etc/rc.local</code> add this before <code>exit 0</code></p>

<pre><code>lsusb | grep 046d:0825 &gt; /dev/null
if [ $?==0 ]; then
    screen -dmS videocap /usr/local/bin/mjpg_streamer \
    -i "/usr/local/lib/input_uvc.so -n -e 4 -f 60 -r 1024x576" \
    -o "/usr/local/lib/output_http.so -w /usr/local/www"
fi
</code></pre>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/ferstar/mjpg-streamer-diy">mjpg-streamer-diy</a> is maintained by <a href="https://github.com/ferstar">ferstar</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
