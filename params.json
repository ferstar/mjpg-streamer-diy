{"name":"mjpg-streamer-diy","tagline":"mjpg-streamer patched for rspi2","body":"# mjpg-streamer-diy\r\n\r\n## Sources:\r\n1. forked from https://svn.code.sf.net/p/mjpg-streamer/code\r\n2. patch from https://www.raspberrypi.org/forums/viewtopic.php?f=28&t=109352\r\n3. usage of `screen` command https://www.ibm.com/developerworks/cn/linux/l-cn-screen/\r\n\r\n## Usage:\r\n\r\n```\r\ncd mjpg-streamer\r\nmake USE_LIBV4L2=true clean all\r\nsudo make DESTDIR=/usr/local install\r\n```\r\n\r\n## My way:\r\n\r\nThe YUV format ate too much memory and cpu time, so I chose MJPEG with `-e` parameter instead.\r\n\r\n```\r\nscreen -dmS videocap /usr/local/bin/mjpg_streamer \\\r\n    -i \"/usr/local/lib/input_uvc.so -n -e 4 -f 60 -r 1024x576\" \\\r\n    -o \"/usr/local/lib/output_http.so -w /usr/local/www\"\r\n```\r\n\r\nthe output info looks like this:\r\n\r\n```\r\n i: Using V4L2 device.: /dev/video0\r\n i: Desired Resolution: 1024 x 576\r\n i: Frames Per Second.: 60\r\n i: Format............: MJPEG\r\n i: Drop Frames Except: 4\r\n o: www-folder-path...: /usr/local/www/\r\n o: HTTP TCP port.....: 8080\r\n o: username:password.: disabled\r\n o: commands..........: enabled\r\n```\r\n\r\nat this capture setting, the bitrate of output mjpg stream is `2000kbps` or above(less than `3000kbps`)\r\n\r\nworks very well on my rspi2.\r\n\r\n> load average: 0.00, 0.01, 0.05\r\n\r\n> CPU load: < 2% (1.3±0.3)%\r\n\r\n## Addition\r\n\r\nYou could change the resolution with the parameters after `-r` but use `uvcdynctrl -f` to see which one is build-in\r\n\r\nhere are my C-270 logitech camera‘s build-in resolution and fps value:\r\n\r\n`uvcdynctrl -f` output:\r\n\r\n```\r\nListing available frame formats for device video0:\r\nPixel format: YUYV (YUV 4:2:2 (YUYV); MIME type: video/x-raw-yuv)\r\n  Frame size: 640x480\r\n    Frame rates: 30, 25, 20, 15, 10, 5\r\n  ...\r\n    ...\r\n  Frame size: 1280x960\r\n    Frame intervals: 2/15, 1/5\r\nPixel format: MJPG (MJPEG; MIME type: image/jpeg)\r\n  Frame size: 640x480\r\n    Frame rates: 30, 25, 20, 15, 10, 5\r\n  ...\r\n    ...\r\n  Frame size: 1280x960\r\n    Frame rates: 30, 25, 20, 15, 10, 5\r\n```\r\n`lsusb` output:\r\n\r\n```\r\n...\r\nBus 001 Device 006: ID 046d:0825 Logitech, Inc. Webcam C270\r\n...\r\n```\r\n\r\nmake mjpg-streamer auto start if USB camera is in:\r\n`vi /etc/rc.local` add this before `exit 0`\r\n```\r\nlsusb | grep 046d:0825 > /dev/null\r\nif [ $?==0 ]; then\r\n    screen -dmS videocap /usr/local/bin/mjpg_streamer \\\r\n    -i \"/usr/local/lib/input_uvc.so -n -e 4 -f 60 -r 1024x576\" \\\r\n    -o \"/usr/local/lib/output_http.so -w /usr/local/www\"\r\nfi\r\n```\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}